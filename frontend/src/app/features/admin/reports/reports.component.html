<div class="admin-reports">
  <div class="page-header">
    <h1>Sales Reports</h1>
    <div class="export-actions">
      <button class="btn btn-outline" (click)="exportReport('excel')">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
          <polyline points="14 2 14 8 20 8" />
        </svg>
        Export Excel
      </button>
      <button class="btn btn-outline" (click)="exportReport('pdf')">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
          <polyline points="14 2 14 8 20 8" />
        </svg>
        Export PDF
      </button>
    </div>
  </div>

  <!-- Date Range Filter -->
  <div class="filters">
    <div class="date-range">
      <label>From:</label>
      <input type="date" [(ngModel)]="dateFrom" (change)="loadReport()" />
    </div>
    <div class="date-range">
      <label>To:</label>
      <input type="date" [(ngModel)]="dateTo" (change)="loadReport()" />
    </div>
    <button class="btn btn-primary" (click)="loadReport()">Apply</button>
  </div>

  @if (isLoading()) {
    <app-loading [center]="true" message="Loading report..." />
  } @else if (report()) {
    <!-- Summary Cards -->
    <div class="summary-grid">
      <div class="summary-card">
        <span class="summary-label">Total Orders</span>
        <span class="summary-value">{{ report()!.summary.totalOrders }}</span>
      </div>
      <div class="summary-card">
        <span class="summary-label">Total Revenue</span>
        <span class="summary-value">{{ report()!.summary.totalRevenue | currency }}</span>
      </div>
      <div class="summary-card">
        <span class="summary-label">Items Sold</span>
        <span class="summary-value">{{ report()!.summary.totalItemsSold }}</span>
      </div>
      <div class="summary-card">
        <span class="summary-label">Avg. Order Value</span>
        <span class="summary-value">{{ getAverageOrderValue() | currency }}</span>
      </div>
    </div>

    <!-- Daily Sales Chart (simplified as table) -->
    <div class="report-section">
      <h2>Daily Sales</h2>
      <div class="chart-container">
        @if (report()!.dailySales.length > 0) {
          <div class="bar-chart">
            @for (day of report()!.dailySales; track day._id) {
              <div class="bar-wrapper">
                <div
                  class="bar"
                  [style.height.%]="getBarHeight(day.revenue)"
                  [title]="day._id + ': ' + (day.revenue | currency)"
                ></div>
                <span class="bar-label">{{ formatDate(day._id) }}</span>
              </div>
            }
          </div>
        } @else {
          <p class="no-data">No sales data for this period</p>
        }
      </div>
    </div>

    <!-- Top Products -->
    <div class="report-section">
      <h2>Top Products</h2>
      <div class="products-table">
        <table>
          <thead>
            <tr>
              <th>Product</th>
              <th>Quantity Sold</th>
              <th>Revenue</th>
            </tr>
          </thead>
          <tbody>
            @for (product of report()!.topProducts; track product.productName) {
              <tr>
                <td>{{ product.productName }}</td>
                <td>{{ product.totalQuantity }}</td>
                <td>{{ product.totalRevenue | currency }}</td>
              </tr>
            } @empty {
              <tr>
                <td colspan="3" class="empty">No product data available</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }
</div>
