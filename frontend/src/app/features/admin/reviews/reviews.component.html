<div class="admin-reviews">
  <div class="page-header">
    <h1>Reviews</h1>
  </div>

  <!-- Filters -->
  <div class="filters">
    <select [(ngModel)]="statusFilter" (change)="loadReviews()">
      <option value="">All Reviews</option>
      <option value="pending">Pending Approval</option>
      <option value="approved">Approved</option>
    </select>
  </div>

  @if (isLoading()) {
    <app-loading [center]="true" message="Loading reviews..." />
  } @else {
    <div class="reviews-list">
      @for (review of reviews(); track review._id) {
        <div class="review-card" [class.pending]="!review.isApproved">
          <div class="review-header">
            <div class="reviewer-info">
              <div class="avatar">{{ getInitials(review.userName) }}</div>
              <div>
                <span class="reviewer-name">{{ review.userName }}</span>
                <span class="review-date">{{ review.createdAt | date: 'mediumDate' }}</span>
              </div>
            </div>
            <div class="review-rating">
              @for (star of [1, 2, 3, 4, 5]; track star) {
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  [attr.fill]="star <= review.rating ? '#fbbf24' : 'none'"
                  [attr.stroke]="star <= review.rating ? '#fbbf24' : '#ccc'"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polygon
                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                  />
                </svg>
              }
            </div>
          </div>
          <p class="review-comment">{{ review.comment }}</p>
          <div class="review-actions">
            @if (!review.isApproved) {
              <button class="btn btn-sm btn-success" (click)="approveReview(review)">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="20 6 9 17 4 12" />
                </svg>
                Approve
              </button>
              <button class="btn btn-sm btn-outline" (click)="rejectReview(review)">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="18" y1="6" x2="6" y2="18" />
                  <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
                Reject
              </button>
            } @else {
              <span class="approved-badge">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="20 6 9 17 4 12" />
                </svg>
                Approved
              </span>
            }
            <button class="btn btn-sm btn-danger-ghost" (click)="confirmDelete(review)">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M3 6h18" />
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
              </svg>
              Delete
            </button>
          </div>
        </div>
      } @empty {
        <div class="empty-state">
          <p>No reviews found</p>
        </div>
      }
    </div>

    @if (pagination()) {
      <app-pagination
        [currentPage]="pagination()!.page"
        [totalPages]="pagination()!.totalPages"
        (pageChange)="onPageChange($event)"
      />
    }
  }
</div>

@if (showDeleteModal) {
  <app-confirm-modal
    [isOpen]="true"
    title="Delete Review"
    message="Are you sure you want to delete this review? This action cannot be undone."
    confirmText="Delete"
    variant="danger"
    (confirm)="deleteReview()"
    (cancel)="showDeleteModal = false"
  />
}
