<div class="testimonial-page">
  <div class="page-header">
    <h1>My Testimonial</h1>
    <p>Share your experience with our store</p>
  </div>

  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
    </div>
  } @else {
    @if (existingTestimonial() && !isEditing()) {
      <!-- View existing testimonial -->
      <div class="testimonial-view">
        <div class="testimonial-card">
          <div class="status-badge" [class.approved]="existingTestimonial()!.isApproved">
            {{ existingTestimonial()!.isApproved ? 'Approved' : 'Pending Approval' }}
          </div>

          <div class="rating-display">
            @for (i of [1, 2, 3, 4, 5]; track i) {
              <span class="star" [class.filled]="i <= existingTestimonial()!.rating">★</span>
            }
          </div>

          <h3 class="testimonial-title">{{ existingTestimonial()!.title }}</h3>
          <p class="testimonial-content">{{ existingTestimonial()!.content }}</p>

          <div class="testimonial-meta">
            Submitted on {{ existingTestimonial()!.createdAt | date: 'mediumDate' }}
          </div>

          <div class="action-buttons">
            <button class="btn btn-primary" (click)="startEditing()">Edit Testimonial</button>
            <button
              class="btn btn-danger"
              (click)="deleteTestimonial()"
              [disabled]="isSubmitting()"
            >
              Delete
            </button>
          </div>
        </div>
      </div>
    } @else {
      <!-- Create or Edit form -->
      <div class="testimonial-form">
        <div class="form-card">
          <h2>{{ existingTestimonial() ? 'Edit Your Testimonial' : 'Write a Testimonial' }}</h2>

          <div class="form-group">
            <label>Your Rating</label>
            <div class="star-rating">
              @for (i of [1, 2, 3, 4, 5]; track i) {
                <button
                  type="button"
                  class="star-btn"
                  [class.filled]="i <= rating"
                  (click)="setRating(i)"
                >
                  ★
                </button>
              }
            </div>
          </div>

          <div class="form-group">
            <label for="title">Title</label>
            <input
              type="text"
              id="title"
              [(ngModel)]="title"
              placeholder="Summarize your experience"
              maxlength="100"
              class="form-input"
            />
            <span class="char-count">{{ title.length }}/100</span>
          </div>

          <div class="form-group">
            <label for="content">Your Experience</label>
            <textarea
              id="content"
              [(ngModel)]="content"
              placeholder="Tell us about your experience with our store..."
              rows="5"
              maxlength="500"
              class="form-textarea"
            ></textarea>
            <span class="char-count">{{ content.length }}/500</span>
          </div>

          <div class="form-actions">
            @if (existingTestimonial()) {
              <button type="button" class="btn btn-secondary" (click)="cancelEditing()">
                Cancel
              </button>
            }
            <button
              type="button"
              class="btn btn-primary"
              (click)="submitTestimonial()"
              [disabled]="isSubmitting()"
            >
              {{ isSubmitting() ? 'Submitting...' : existingTestimonial() ? 'Update' : 'Submit' }}
            </button>
          </div>

          <p class="form-note">
            Your testimonial will be visible on the homepage after admin approval.
          </p>
        </div>
      </div>
    }
  }
</div>
